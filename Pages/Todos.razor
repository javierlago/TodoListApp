@page "/todos"

@* —— Feedback placeholder —— *@
@if (!string.IsNullOrWhiteSpace(feedbackText))
{
    <Feedback Text="@feedbackText"
              Type="@feedbackType"
              AutoHideMs="@feedbackAutoHideMs"
              OnClosed="HandleFeedbackClosed" />
}

<h3>Lista de Tareas</h3>
<p>Tareas pendientes: @PendingCount</p>

@if (Items == null || !Items.Any())
{
    <p>No hay tareas aún.</p>
}
else
{
<div class="mb-3">
    <button class="btn btn-sm @(currentFilter == ViewFilter.All ? "btn-primary" : "btn-outline-primary")"
            @onclick="() => currentFilter = ViewFilter.All">
        Todas
    </button>

    <button class="btn btn-sm @(currentFilter == ViewFilter.Active ? "btn-primary" : "btn-outline-primary")"
            @onclick="() => currentFilter = ViewFilter.Active">
        Pendientes
    </button>

    <button class="btn btn-sm @(currentFilter == ViewFilter.Completed ? "btn-primary" : "btn-outline-primary")"
            @onclick="() => currentFilter = ViewFilter.Completed">
        Hechas
    </button>



</div>



<button class="btn btn-outline-danger"
        @onclick="ClearCompletedAsync"
        disabled="@(Items == null || !HasCompleted)">
    Limpiar completadas
</button>


<ul>
    @foreach (var item in GetViewItems())
    {
        <li>
            <input type="checkbox"
                   checked="@item.IsDone"
                   @onchange="@(() => ToggleDone(item.Id))" />

            @if (editingId == item.Id)
            {
                <InputText class="form-control d-inline w-auto"
                           @bind-Value="editedTitle" />
                <button class="btn btn-sm btn-success ms-2"
                        @onclick="@(() => SaveEdit(item.Id))">
                    Guardar
                </button>
                <button class="btn btn-sm btn-secondary ms-1"
                        @onclick="CancelEdit">
                    Cancelar
                </button>
            }
            else
            {
                @item.Title <span>(@((item.IsDone ? "Hecha" : "Pendiente")))</span>
                <button class="btn btn-sm btn-warning ms-2"
                        @onclick="@(() => StartEdit(item))">
                    Editar
                </button>
                <button class="btn btn-sm btn-danger ms-1"
                        @onclick="@(() => DeleteTodo(item.Id))">
                    Eliminar
                </button>
            }
        </li>
    }
</ul>


}
<EditForm Model="@newItem" OnValidSubmit="AddTodo">
    <DataAnnotationsValidator />

    <div class="mb-3">
        <label>Título de la tarea:</label>
        <InputText class="form-control" @bind-Value="newItem.Title" />
        <ValidationMessage For="@(() => newItem.Title)" />
    </div>

    <button type="submit" class="btn btn-primary">Añadir tarea</button>
</EditForm>
